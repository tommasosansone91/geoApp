<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>leaflet geoproject</title>

    <style>
        #map{
            width: 100%;
            height: 700px;
        }
    </style>

    <!-- Include Leaflet CSS file in the head section of your document: -->
     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
     integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
     crossorigin=""/>

     <!-- this is the css for a js tool that allows to take measures on the map. the js is importes later, after html closure tag -->
     <link rel="stylesheet" href="./lib/leaflet-measure.css"/>

     <!-- load tool leaflet markers cluster styyles -->
     <link rel="stylesheet" href="./lib/MarkerCluster.css"/>
     <link rel="stylesheet" href="./lib/MarkerCluster.Default.css"/>

</head>

<body>
    <!--  this is where i want my map to be -->
    <div style="height: 500px; width: 90%;" id="map"></div>
    <!-- set this style onòy to fit the screen where i am developing -->

    <button onclick=fullScreenview()>View in full screen</button>
    <!-- this is a user defined function -->

    <div class="coordinate">void</div>

    <button class="print-map">Print map</button>

</body>

</html>

<!-- Include Leaflet JavaScript file after Leaflet’s CSS: -->
<!-- Make sure you put this AFTER Leaflet's CSS -->
<!-- <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script> -->

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

<!-- load jquery. I put this after leaflet -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 

<!-- import a library leaflet.browser.print from local folder lib placed at same path f this script -->
<script src="./lib/leaflet.browser.print.min.js"></script>

<!-- import a library measure-leaflet from local folder lib placed at same path f this script -->
<script src="./lib/leaflet-measure.js"></script>
<!-- this library also requires a css lib , because styles are defined in there. it has to be loaded in head -->

<!-- load the json containing the data ò they must still be displayed on the map-->
<script src="./data/test_data.js"></script>

<!-- load tool leaflet markers cluster -->
<script src="./lib/leaflet.markercluster.js"></script>


<script>
    // initializig the class map
    // var map = L.map('map', {
    //     measureControl: true, // this is necessary to allow the measure lib to work
    // }    ).setView([44.8683931,9.2651729], 15);
    // otherwise,
    var map = L.map('map').setView([44.8683931,9.2651729], 14);
    // would be enough

    map.zoomControl.setPosition('topright');

        // adding osm layer
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // main marker
    //  define its style - https://stackoverflow.com/questions/23567203/leaflet-changing-marker-color
    var greenIcon = new L.Icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
        });

    L.marker([44.8683931,9.2651729], {icon: greenIcon}).addTo(map)
        .bindPopup('Zavattarello')  // label on my pointer
        .openPopup();

    // add map scale
    L.control.scale().addTo(map);

    // full sreeen function
    var mapId = document.getElementById('map');

    function fullScreenview() {
        mapId.requestFullscreen();
    }

    // display the coordinates of the point pf hte map where the mouse is
    // i need jquery for this

    // when the mouse is over the map - when the map fires the event mousemove
    map.on('mousemove', function(e) {


        // this is a nice way to chek if the info I want is got correctly
        console.log(e);
        // console.log(e.latlng.lat);
        // console.log(e.latlng.lng);

        // replace the content of the element having class coordinate with the html
        $('.coordinate').html(`Lat: ${e.latlng.lat} Long: ${e.latlng.lng}`);
    });

    // print map
    $('.print-map').click(function(){
        window.print();
    });

    // uses this library got from remote
    // ./lib/leaflet.browser.print.min.js
    //  to load a print wdget on the map
    L.control.browserPrint().addTo(map);

    // this loads on the map a widget to measure distances . leaflet-measure
    L.control.measure({
        primaryLengthUnit: 'meters',
        primaryAreaUnit:'sqmeters',
        secondaryLengthUnit: 'kilometers',
    }).addTo(map);

    // load geojson data on the map
    // L.geoJSON(map_data_1).addTo(map);
    // deleted to be replaced with markercluster

    // now with marker cluster
    var marker = L.markerClusterGroup(); // initialize var marker from class markerclustergroup

    // var map_data_v1 = L.geoJSON(map_data_1);

    var map_data_v1 = L.geoJSON(map_data_1, {
        onEachFeature: function(feature, layer) {
            // layer.bindPopup('test label')
            layer.bindPopup(feature.properties.name)
        }
    });

    map_data_v1.addTo(marker);

    marker.addTo(map);

    




</script>

